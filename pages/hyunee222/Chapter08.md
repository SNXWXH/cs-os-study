# 입출력장치

## 장치 컨트롤러와 장치 드라이버

### 장치 컨트롤러

입출력장치는 컴퓨터에 직접 연결되지 않고 <code>장치 컨트롤러</code> 라는 하드웨어를 통해 연결됨

#### 이유

<ul>
  <li>CPU와 입출력장치 간의 통신 중개</li>
  <li>오류 검출</li>
  <li>데이터 버퍼링</li>
</ul><br>
  ➡️ <strong>데이터 버퍼링</strong> : 전송률이 빠른 CPU와 전송률이 느린 입출력장치를 <code>버퍼</code>라는 임시 저장 공간을 이용해 전송률을 비슷하게 맞추는 방법

<strong>장치 컨트롤러</strong> : 실제론 더 복잡하지만 간략하게 <code>데이터 레지스터</code> + <code>상태 레지스터</code> + <code>제어 레지스터</code>

<strong>장치 드라이버</strong> : 장치 컨트롤러가 컴퓨터 내부와 정보를 주고받을수 있게 하는 프로그램

---

## 다양한 입출력 방법

### 프로그램 입출력

<strong>프로그램 입출력</strong> : 프로그램 속 명령어로 입출력장치를 제어하는 방법

<ol>
  <li>CPU가 제어 레지스터에 명령 전송</li>
  <li>입출력장치가 작업 수행</li>
  <li>입출력장치가 상태 레지스터에 현재 상태를 계속 업데이트하여 표시</li>
  <li>CPU가 상태 레지스터를 읽어 입출력장치의 상태 확인</li>
  <li>CPU가 데이터 레지스터에 데이터를 씀</li>
</ol>

#### 프로그램 입출력 방식

<strong>메모리 맵 입출력</strong>:<br><code>메모리에 접근하기 위한 주소 공간</code> 과 <code>입출력장치에 접근하기 위한 주소 공간</code> 을 하나의 주소 공간으로 간주하는 입출력 방식

##### 장점

<ul>
  <li>같은 주소 공간을 사용하여 작업 속도가 빠름</li>
  <li>메모리와 입출력장치에 같은 명령어를 사용 가능</li>
</ul>

##### 단점

<ul>
  <li>입출력장치가 메모리보다 느리기 때문에 효율성 저하</li>
  <li>메모리 주소 공간의 일부를 입출력장치에 할당해야 되므로 사용 가능한 메모리 감소</li>
</ul>

<strong>고립형 입출력</strong> :<br><code>메모리를 위한 주소 공간</code> 과 <code>입출력장치를 위한 주소 공간</code> 을 분리하는 입출력 방식

##### 장점

<ul>
  <li>별도의 주소 공간을 사용하므로 작업이 효율적</li>
  <li>작업을 위한 더 큰 메모리 공간 제공</li>
</ul>

##### 단점

<ul>
  <li>분리된 공간을 사용해 명령어가 제한적</li>
  <li>메모리형 입출력보다 작업 속도가 느림</li>
</ul>

---

### 인터럽트 기반 입출력

<strong>인터럽트 기반 입출력</strong> : 인터럽트를 기반으로 하는 입출력

1. 장치 컨트롤러 입출력 작업을 마침
2. CPU에게 인터럽트 요청 신호 보냄
3. CPU는 하던 일을 백업하고 `인터럽트 서비스 루틴` 을 실행

<strong>여러 인터럽트가 동시에 발생했을 경우?</strong>: NMI<br>
➡️ 우선순위 높은 인터럽트부터 순서대로 하나씩 처리, 인터럽트를 처리하기 위해 <code>PIC</code>를 사용

<strong>PIC</storng>: 여러 장치 컨트롤러에 연결되어 하드웨어 인터럽트 요청들의 우선순위를 판별하여 CPU에 해결 순서를 제시하는 장치

##### 과정

<ol>
  <li>PIC가 장치 컨트롤러에서 인터럽트 요청 신호 승인</li>
  <li>PIC가 우선순위를 판별한뒤 CPU에 처리해야 할 <code>인터럽트 요청 신호</code>를 보냄</li>
  <li>CPU는 PIC에 <code>인터럽트 확인 신호</code>를 보냄</li>
  <li>PIC는 데이터 버스를 통해 CPU에 <code>인터럽트 벡터</code>를 전송</li>
  <li>CPU는 인터럽트 벡터를 통해 요청을 확인하고, 해당 장치의 인터럽트 서비스 루틴을 실행</li>
</ol>

### DMA 입출력

<strong>DMA 입출력</strong>: 직접 메모리에 접근할 수 있는 기능, 시스템 버스에 연결된 <code>DMA 컨트롤러</code>라는 하드웨어가 필요함

##### 과정

<ol>
  <li>CPU는 <code>DMA 컨트롤러</code>에 입출력장치의 주소, 수행할 연산, 메모리의 주소 등 정보로 입출력 작업을 명령</li>
  <li>DMA 컨트롤러가 CPU 대신 장치 컨트롤러와 상호작용하며 입출력 작업 수행</li>
  <li>작업이 끝나면 CPU에 인터럽트를 걸어 작업 완료를 알림</li>
</ol>

‼️ 시스템 버스는 하나의 장치만 사용 가능하므로 CPU와 DMA 컨트롤러가 동시 사용 불가

➡️ <code>사이클 스틸링</code> : DMA 컨트롤러가 시스템 버스를 이용할때 CPU가 버스 사용을 일시정지 시키는 현상

---

### 입출력 버스

<strong>입출력 버스</strong> : DMA 컨트롤러와 장치 컨트롤러들을 연결해주는 버스

➡️ DMA가 시스템 버스를 사용하면 그동안 CPU가 버스를 사용하지 못하므로 사용 빈도를 줄이기 위함

⭐️ 대표적으로 <code>PCI,PCIe</code>
